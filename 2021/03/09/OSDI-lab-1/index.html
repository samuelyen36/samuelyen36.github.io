<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>OSDI_lab1 | Sam's blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-198020762-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OSDI_lab1</h1><a id="logo" href="/.">Sam's blog</a><p class="description">Personal blog of Sam</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OSDI_lab1</h1><div class="post-meta">2021-03-09<span> | </span><span class="category"><a href="/categories/%E8%B3%87%E5%B7%A5/">資工</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>這次作業主要是要學生練習撰寫簡單的bootloader，以及如何在沒有OS的狀況下撰寫程式<br>看這篇文章可以考慮跟著reference的resource和我的github repository一起讀<br>這樣可能會比較知道在幹麻（？</p>
<h2 id="Terms"><a href="#Terms" class="headerlink" title="Terms"></a>Terms</h2><ul>
<li>bare-metal: develop program without OS</li>
<li>boot loader: the program that is executed after the BIOS is being booted</li>
<li>elf: Executable and Linkable Format </li>
<li>Peripherals: 周邊設備</li>
<li>UART: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter">Universal asynchronous receiver-transmitter</a>，可以把memory-mapped register內的value轉成sequence of high and low voltage and pass it to the computer via TTL-to-serial cable.</li>
</ul>
<h2 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h2><p>當專案有許多檔案，且處理方式複雜，有dependency時，makefile就是好幫手<br>可以看看此<a target="_blank" rel="noopener" href="https://bit.ly/3sOqwON">網站</a>了解詳情</p>
<ul>
<li>COPS: parameters of C compiler</li>
<li>nostdlib: don’t use C std lib. The reason is that C std lib eventually interact with operating system.</li>
<li>nostartfiles: don’t use standard startup files. It would setting an initial stack pointer…… But we’ll do it on our own</li>
</ul>
<h2 id="Linker-Script"><a href="#Linker-Script" class="headerlink" title="Linker Script"></a>Linker Script</h2><p>describe how the sections in the input object files (???.o) should be mapped into the output file (???.elf).<br>Making the size of .bss to be multiple of 8. It allows us to use str to initialize .bss section to zero.</p>
<h3 id="more-explanation-on-linker-script"><a href="#more-explanation-on-linker-script" class="headerlink" title="more explanation on linker script"></a>more explanation on linker script</h3><p>第一行的SECTION是keywords, 代表開始宣告SECTIONS<br>“.” 在linker script中代表 location counter，會隨著宣告的section而增加。也可以直接assign值給location counter，例如 .=0x80000;<br>接下來，用個小例子來解釋</p>
<blockquote>
<p>  .rodata : { *(.rodata) }</p>
</blockquote>
<p>左方的.rodata代表，定義一個output section，名為rodata(read-only data)。而{}中的內容，則是將input file的rodata放入這個定義的output section。<br>*則是wildcard符號，概念很像下指令會使用的*，就是一個for all的概念<br>在linker script之中需要紀錄bss.begin和bss.end，為了之後初始化使用<br>不然linker script只會紀錄section大小</p>
<h2 id="boot-S"><a href="#boot-S" class="headerlink" title="boot.S"></a>boot.S</h2><p>the program being executed after the RPI3 is booted.</p>
<h3 id="detailed"><a href="#detailed" class="headerlink" title="detailed"></a>detailed</h3><ul>
<li>MPIDR_EL1: register that stores the processor ID.</li>
</ul>
<p>For RPI3 has four cores and we only want to execute the program once, so we check the processor ID of current process. Making sure that only the core with ID equals to zero execute this program.<br>Then, we ask one processor to initializing bss section.<br>After initializing the stack pointer, we can execute our kernel program.</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a target="_blank" rel="noopener" href="https://grasslab.github.io/NYCU_Operating_System_Capstone/labs/lab1.html">lab document</a><br>這次作業大致follow這個 <a target="_blank" rel="noopener" href="https://github.com/s-matyukevich/raspberry-pi-os">toturial</a><br><a target="_blank" rel="noopener" href="https://github.com/samuelyen36/osc2021">my github repository</a>(in branch lab1)</p>
</div><div class="tags"><a href="/tags/OSDI/"><i class="fa fa-tag"></i>OSDI</a></div><div class="post-nav"><a class="pre" href="/2021/03/18/OSD-lab-2/">OSD_lab2</a><a class="next" href="/2021/02/25/OSDI-week0/">NYCU OSDI - prelude</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://samuelyen36.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AD%E8%A8%98/">札記</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B3%87%E5%B7%A5/">資工</a><span class="category-list-count">11</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/OSDI/" style="font-size: 15px;">OSDI</a> <a href="/tags/%E9%97%9C%E6%96%BC%E9%83%A8%E8%90%BD%E6%A0%BC/" style="font-size: 15px;">關於部落格</a> <a href="/tags/%E6%AD%8C/" style="font-size: 15px;">歌</a> <a href="/tags/%E9%81%8A%E8%A8%98/" style="font-size: 15px;">遊記</a> <a href="/tags/Modern-C/" style="font-size: 15px;">Modern_C++</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/06/17/mod-cpp-ch2-3/">Modern C++ - Ch2.3 Type inference</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/06/17/mod-cpp-ch2-1/">Modern C++ - Ch2.1 Constant</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/29/trip-20210529/">遊記 - 武嶺</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/05/23/trip-20210430/">遊記 - 新竹北埔、五峰、南寮</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/20/osd-note-L8/">OSD_L8_note</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/13/osd-note-L7/">OSD_L7_note</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/06/osd-note-L6/">OSD_L6_note</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/20/osd-note-L5/">OSD_L5_note</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/18/OSD-note-L4/">OSD_L4_note</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/18/OSD-note-L3/">OSD_L3_note</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/samuelyen36" title="github" target="_blank">github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Sam's blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>